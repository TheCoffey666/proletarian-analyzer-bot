import os
from telegram.ext import ApplicationBuilder, CommandHandler

TOKEN = os.getenv("BOT_TOKEN")
print("BOT_TOKEN from env:", TOKEN)

if not TOKEN:
    raise ValueError("BOT_TOKEN is not set. Please check your environment variables.")

app = ApplicationBuilder().token(TOKEN).build()

# –¢–µ–∫—Å—Ç —à–∞–±–ª–æ–Ω–∞ –∞–Ω–∞–ª–∏–∑–∞
ANALYSIS_SCHEMA = """
üîß –®–∞–±–ª–æ–Ω –ø—Ä–æ–ª–µ—Ç–∞—Ä—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –Ω–æ–≤–æ—Å—Ç–∏

1. **–§–∞–∫—Ç (–±—ã—Ç–∏–µ)**  
–ß—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ, –±–µ–∑ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏?  
–ü—Ä–∏–º–µ—Ä: ¬´–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –±–∞–Ω–∫ –ø–æ–≤—ã—Å–∏–ª –∫–ª—é—á–µ–≤—É—é —Å—Ç–∞–≤–∫—É –Ω–∞ 1%.¬ª

2. **–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è (–Ω–∞–¥—Å—Ç—Ä–æ–π–∫–∞)**  
–ö–∞–∫ —ç—Ç–æ –ø–æ–¥–∞—ë—Ç—Å—è –≤ –∏—Å—Ç–æ—á–Ω–∏–∫–µ? –ö–∞–∫–∏–µ –ø—Ä–∏—á–∏–Ω—ã –Ω–∞–∑–≤–∞–Ω—ã? –ö–∞–∫–∏–µ —á—É–≤—Å—Ç–≤–∞ —Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è?  
–ü—Ä–∏–º–µ—Ä: ¬´–î–ª—è —Å–¥–µ—Ä–∂–∏–≤–∞–Ω–∏—è –∏–Ω—Ñ–ª—è—Ü–∏–∏ –∏ —É–∫—Ä–µ–ø–ª–µ–Ω–∏—è –¥–æ–≤–µ—Ä–∏—è –∫ —Ä—É–±–ª—é.¬ª

3. **–ö–ª–∞—Å—Å–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è**  
–ö–æ–º—É –≤—ã–≥–æ–¥–Ω–∞ —Ç–∞–∫–∞—è –ø–æ–¥–∞—á–∞? –ß—å–∏ –∏–Ω—Ç–µ—Ä–µ—Å—ã –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ?  
–ü—Ä–∏–º–µ—Ä: –£–∫—Ä–µ–ø–ª—è–µ—Ç –ø–æ–∑–∏—Ü–∏—é –±—É—Ä–∂—É–∞–∑–∏–∏, —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –æ ¬´–Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏¬ª –∞–Ω—Ç–∏–Ω–∞—Ä–æ–¥–Ω–æ–π –º–µ—Ä—ã.

4. **–ú–æ–ª—á–∞–Ω–∏–µ (—á—Ç–æ —Å–∫—Ä—ã—Ç–æ?)**  
–û —á—ë–º –Ω–µ —Å–∫–∞–∑–∞–Ω–æ? –ö–∞–∫–∏–µ –∞—Å–ø–µ–∫—Ç—ã –Ω–∞–º–µ—Ä–µ–Ω–Ω–æ —É–ø—É—â–µ–Ω—ã?  
–ü—Ä–∏–º–µ—Ä: –ù–µ —É–ø–æ–º—è–Ω—É—Ç–æ, –∫–∞–∫ —Ä–æ—Å—Ç —Å—Ç–∞–≤–∫–∏ —É–¥–∞—Ä–∏—Ç –ø–æ –∑–∞–µ–º—â–∏–∫–∞–º, –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤—É, –ñ–ö–•.

5. **–ú–∞—Ç–µ—Ä–∏–∞–ª—å–Ω–∞—è –ø–æ–¥–æ–ø–ª—ë–∫–∞**  
–ö–∞–∫–∏–µ —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ –∏–Ω—Ç–µ—Ä–µ—Å—ã –∏ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è –ª–µ–∂–∞—Ç –≤ –æ—Å–Ω–æ–≤–µ —è–≤–ª–µ–Ω–∏—è?  
–ü—Ä–∏–º–µ—Ä: –ò–Ω—Ñ–ª—è—Ü–∏—è –≤—ã–∑–≤–∞–Ω–∞ —Ä–æ—Å—Ç–æ–º –∏–∑–¥–µ—Ä–∂–µ–∫ –∏ –º–æ–Ω–æ–ø–æ–ª–∏–∑–∞—Ü–∏–µ–π, –∞ –Ω–µ ¬´–ø–∞–Ω–∏–∫–æ–π¬ª.

6. **–¶–µ–ª—å (—Ç–µ–ª–µ–æ–ª–æ–≥–∏—è)**  
–ó–∞—á–µ–º –∏–º–µ–Ω–Ω–æ —ç—Ç–∞ –Ω–æ–≤–æ—Å—Ç—å –ø–æ—è–≤–∏–ª–∞—Å—å –≤ —Ç–∞–∫–æ–º –≤–∏–¥–µ? –ß—Ç–æ –æ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –≤—ã–∑–≤–∞—Ç—å?  
–ü—Ä–∏–º–µ—Ä: –°–Ω–∏–∑–∏—Ç—å –≤–æ–∑–º—É—â–µ–Ω–∏–µ, –≤–Ω—É—à–∏—Ç—å —Ñ–∞—Ç–∞–ª–∏–∑–º, –æ–ø—Ä–∞–≤–¥–∞—Ç—å –±—É—Ä–∂—É–∞–∑–Ω—É—é –ø–æ–ª–∏—Ç–∏–∫—É.

7. **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è (–ø—Ä–æ–ª–µ—Ç–∞—Ä—Å–∫–∞—è) —Ç—Ä–∞–∫—Ç–æ–≤–∫–∞**  
–ö–∞–∫ –±—ã –≤—ã–≥–ª—è–¥–µ–ª–æ —Å–æ–æ–±—â–µ–Ω–∏–µ, –µ—Å–ª–∏ –±—ã –µ–≥–æ –ø–∏—Å–∞–ª–∏ —Å –ø–æ–∑–∏—Ü–∏–∏ —Ä–∞–±–æ—á–µ–≥–æ –∫–ª–∞—Å—Å–∞?  
–ü—Ä–∏–º–µ—Ä: ¬´–¶–ë –ø–µ—Ä–µ–ª–æ–∂–∏–ª –∏–Ω—Ñ–ª—è—Ü–∏–æ–Ω–Ω—ã–µ –∏–∑–¥–µ—Ä–∂–∫–∏ –Ω–∞ —Ç—Ä—É–¥—è—â–∏—Ö—Å—è, —á—Ç–æ–±—ã —Å–ø–∞—Å—Ç–∏ —Å–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω—ã–π –∫–∞–ø–∏—Ç–∞–ª.¬ª
"""

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await update.message.reply_text("–ü—Ä–∏–≤–µ—Ç! –ù–∞–ø–∏—à–∏ /schema –¥–ª—è —à–∞–±–ª–æ–Ω–∞ –∞–Ω–∞–ª–∏–∑–∞ –∏–ª–∏ /analyze —á—Ç–æ–±—ã —Ä–∞–∑–æ–±—Ä–∞—Ç—å –Ω–æ–≤–æ—Å—Ç—å.")

async def schema(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await update.message.reply_text(ANALYSIS_SCHEMA, parse_mode="Markdown")

async def analyze(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await update.message.reply_text("–û—Ç–ø—Ä–∞–≤—å –Ω–æ–≤–æ—Å—Ç—å –∏–ª–∏ —Ñ—Ä–∞–≥–º–µ–Ω—Ç —Ç–µ–∫—Å—Ç–∞, –∏ —è –ø–æ–º–æ–≥—É —Ä–∞–∑–æ–±—Ä–∞—Ç—å –µ—ë –ø–æ –ø—Ä–æ–ª–µ—Ç–∞—Ä—Å–∫–æ–º—É —à–∞–±–ª–æ–Ω—É.")

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –ª—é–±—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ—Å–ª–µ /analyze
async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user_text = update.message.text
    response = f"""
–ù–∞—á–∏–Ω–∞–µ–º –∞–Ω–∞–ª–∏–∑:

1. **–§–∞–∫—Ç (–±—ã—Ç–∏–µ)**  
üîπ {user_text}

2. **–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è (–Ω–∞–¥—Å—Ç—Ä–æ–π–∫–∞)**  
üî∏ (–ö–∞–∫ —ç—Ç–æ –ø–æ–¥–∞—ë—Ç—Å—è? –ö—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç? –ö–∞–∫–∏–µ —á—É–≤—Å—Ç–≤–∞ –≤—ã–∑—ã–≤–∞–µ—Ç?)

3. **–ö–ª–∞—Å—Å–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è**  
üî∏ (–ß—å–∏ –∏–Ω—Ç–µ—Ä–µ—Å—ã –æ–±—Å–ª—É–∂–∏–≤–∞—é—Ç—Å—è? –ö–æ–º—É –≤—ã–≥–æ–¥–Ω–æ?)

4. **–ú–æ–ª—á–∞–Ω–∏–µ (—á—Ç–æ —Å–∫—Ä—ã—Ç–æ?)**  
üî∏ (–û —á—ë–º —É–º–æ–ª—á–∞–ª–∏?)

5. **–ú–∞—Ç–µ—Ä–∏–∞–ª—å–Ω–∞—è –ø–æ–¥–æ–ø–ª—ë–∫–∞**  
üî∏ (–ö–∞–∫–∏–µ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è –≤ –æ—Å–Ω–æ–≤–µ —Å–æ–±—ã—Ç–∏—è?)

6. **–¶–µ–ª—å (—Ç–µ–ª–µ–æ–ª–æ–≥–∏—è)**  
üî∏ (–ó–∞—á–µ–º –∏–º–µ–Ω–Ω–æ –≤ —Ç–∞–∫–æ–º –≤–∏–¥–µ? –ß—Ç–æ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç?)

7. **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è —Ç—Ä–∞–∫—Ç–æ–≤–∫–∞**  
üî∏ (–ö–∞–∫ –±—ã –≤—ã–≥–ª—è–¥–µ–ª–æ —Å –ø–æ–∑–∏—Ü–∏–∏ —Ç—Ä—É–¥—è—â–∏—Ö—Å—è?)
"""
    await update.message.reply_text(response, parse_mode="Markdown")

# –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
if __name__ == "__main__":
    app = ApplicationBuilder().token(TOKEN).build()

    app.add_handler(CommandHandler("start", start))
    app.add_handler(CommandHandler("schema", schema))
    app.add_handler(CommandHandler("analyze", analyze))
    app.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_message))

    print("–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω...")
    app.run_polling()
